'use client';

import { motion } from 'framer-motion';
import { memo, useState, useEffect } from 'react';

// Dane opinii z adaptacjƒÖ do taxi - 8 r√≥≈ºnych opinii
const TESTIMONIALS = [
  {
    name: "Marta K.",
    text: "Ca≈Çy proces wynajmu taxi zastƒôpczego z Zastepczak.pl przebieg≈Ç bezproblemowo. Od pierwszego kontaktu z firmƒÖ by≈Çam prowadzona przez ka≈ºdƒÖ formalno≈õƒá, a wszelkie wƒÖtpliwo≈õci by≈Çy natychmiast rozwiewane przez profesjonalnƒÖ obs≈Çugƒô. Transport taxi podstawiono pod m√≥j dom w zaledwie kilka godzin po zg≈Çoszeniu szkody. Serdecznie polecam!",
    rating: 5,
    service: "Taxi zastƒôpcze",
    location: "Warszawa"
  },
  {
    name: "Krzysztof T.",
    text: "Zastepczak.pl to firma, kt√≥ra naprawdƒô dba o swoich klient√≥w. Proces wynajmu by≈Ç szybki i bezproblemowy, a pracownicy firmy pomagali mi na ka≈ºdym kroku. Taxi zastƒôpcze dosta≈Çem od razu po wypadku. Dziƒôkujƒô za pomoc i profesjonalizm!",
    rating: 5,
    service: "Transport zastƒôpczy",
    location: "Krak√≥w"
  },
  {
    name: "Monika L.",
    text: "Mia≈Çam kolizjƒô, a m√≥j samoch√≥d musia≈Ç byƒá naprawiany przez kilka tygodni. Dziƒôki Zastepczak.pl dosta≈Çam ≈õwietny transport taxi na ca≈Çy ten czas. Ca≈Ça procedura by≈Ça prosta i zrozumia≈Ça, a pracownicy firmy byli niezwykle uprzejmi i pomocni. GorƒÖco polecam tƒô firmƒô ka≈ºdemu, kto potrzebuje taxi z OC sprawcy.",
    rating: 5,
    service: "Taxi d≈Çugoterminowe",
    location: "Gda≈Ñsk"
  },
  {
    name: "Jan B.",
    text: "Jestem bardzo zadowolony z us≈Çug Zastepczak.pl. Proces wynajmu taxi zastƒôpczego by≈Ç szybki i bezproblemowy, a obs≈Çuga klienta by≈Ça na najwy≈ºszym poziomie. Dosta≈Çem lepszy transport ni≈º siƒô spodziewa≈Çem. Wszystkie formalno≈õci za≈Çatwiono za mnie, polecam.",
    rating: 5,
    service: "Taxi z OC sprawcy",
    location: "Wroc≈Çaw"
  },
  {
    name: "Tomasz W.",
    text: "Po wypadku by≈Çem bardzo zestresowany, ale Zastepczak.pl zrobi≈Ç wszystko, aby mi pom√≥c. W ciƒÖgu kilku godzin od zg≈Çoszenia szkody mia≈Çem ju≈º taxi pod domem. Ca≈Çy proces by≈Ç przejrzysty, a pracownicy firmy bardzo pomocni. Dziƒôki nim mog≈Çem spokojnie zajƒÖƒá siƒô innymi sprawami.",
    rating: 5,
    service: "Transport awaryjny",
    location: "Pozna≈Ñ"
  },
  {
    name: "Anna S.",
    text: "Taxi zastƒôpcze z Zastepczak.pl to prawdziwa pomoc w trudnej sytuacji. Po kolizji nie wiedzia≈Çam jak dotrzeƒá do pracy, ale ju≈º nastƒôpnego dnia mia≈Çam zapewniony transport. Kierowcy zawsze punktualni i uprzejmi. Obs≈Çuga na najwy≈ºszym poziomie!",
    rating: 5,
    service: "Transport do pracy",
    location: "≈Å√≥d≈∫"
  },
  {
    name: "Piotr N.",
    text: "Profesjonalna obs≈Çuga od A do Z. Wszystkie formalno≈õci z ubezpieczycielem za≈Çatwione bez mojego udzia≈Çu. Taxi zawsze czyste i wygodne. Kierowcy znajƒÖ miasto doskonale. Polecam ka≈ºdemu, kto potrzebuje niezawodnego transportu po wypadku.",
    rating: 5,
    service: "Transport miejski",
    location: "Katowice"
  },
  {
    name: "Magdalena R.",
    text: "Po uszkodzeniu mojego auta w kolizji, taxi z Zastepczak.pl by≈Ço moim ratunkiem. Szybka realizacja, elastyczne godziny, a przede wszystkim - wszystko pokryte z OC sprawcy. Nie musia≈Çam siƒô martwiƒá o dodatkowe koszty. ≈öwietna firma!",
    rating: 5,
    service: "Taxi ca≈Çodobowe",
    location: "Szczecin"
  },
  {
    name: "Robert K.",
    text: "Mia≈Çem wypadek w drodze do pracy i potrzebowa≈Çem szybkiego rozwiƒÖzania. Taxi z Zastepczak.pl okaza≈Ço siƒô strza≈Çem w dziesiƒÖtkƒô. Bez stresu, bez dodatkowych koszt√≥w, a kierowcy zawsze punktualni. Wszystkie kursy pokryte z OC sprawcy - polecam!",
    rating: 5,
    service: "Transport codzienny",
    location: "Bydgoszcz"
  },
  {
    name: "Karolina M.",
    text: "Fantastic service! Po kolizji na parkingu potrzebowa≈Çam transportu na kilka tygodni. Zesp√≥≈Ç Zastepczak.pl za≈Çatwi≈Ç wszystko b≈Çyskawicznie. Taxi zawsze czyste, kierowcy profesjonalni. ≈ªadnych problem√≥w z ubezpieczycielem - wszystko zosta≈Ço za≈Çatwione za mnie.",
    rating: 5,
    service: "Transport d≈Çugoterminowy",
    location: "Gdynia"
  }
];

// Statystyki
const STATS = [
  { number: "10000+", label: "wynajƒôtych przejazd√≥w", icon: "üöñ" },
  { number: "15 minut", label: "proste formalno≈õci", icon: "‚è±Ô∏è" },
  { number: "95%", label: "pozytywnych opinii", icon: "‚≠ê" },
  { number: "100+", label: "przejazd√≥w dostƒôpnych od rƒôki!", icon: "üöó" }
];

// Animacje
const containerVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.15
    }
  }
} as const;

const cardVariants = {
  hidden: { opacity: 0, y: 30 },
  visible: { 
    opacity: 1, 
    y: 0,
    transition: { duration: 0.6, ease: [0.4, 0, 0.2, 1] }
  }
} as const;

const statVariants = {
  hidden: { opacity: 0, scale: 0.8 },
  visible: { 
    opacity: 1, 
    scale: 1,
    transition: { duration: 0.5, ease: [0.4, 0, 0.2, 1] }
  }
} as const;

function TestimonialsSection() {
  const [currentTestimonial, setCurrentTestimonial] = useState(0);
  const [isAutoPlaying, setIsAutoPlaying] = useState(true);

  // Auto-play funkcjonalno≈õƒá
  useEffect(() => {
    if (!isAutoPlaying) return;
    
    const interval = setInterval(() => {
      setCurrentTestimonial((prev) => 
        prev === TESTIMONIALS.length - 1 ? 0 : prev + 1
      );
    }, 5000);

    return () => clearInterval(interval);
  }, [isAutoPlaying]);

  const renderStars = (rating: number) => {
    return (
      <div className="flex items-center gap-1">
        {[...Array(5)].map((_, i) => (
          <svg
            key={i}
            className="w-4 h-4"
            fill={i < rating ? '#fbbf24' : '#e5e7eb'}
            viewBox="0 0 20 20"
          >
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
          </svg>
        ))}
      </div>
    );
  };

  return (
    <section className="bg-gradient-to-br from-gray-50 to-white py-16 lg:py-20 relative overflow-hidden">
      {/* T≈Ço z animowanymi kszta≈Çtami */}
      <div className="absolute inset-0">
        <div className="absolute top-1/4 right-1/4 w-96 h-96 rounded-full blur-3xl bg-gold-700/10 animate-pulse" />
        <div className="absolute bottom-1/3 left-1/4 w-80 h-80 rounded-full blur-3xl bg-gold-700/8" />
      </div>

      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        {/* Header */}
        <motion.div 
          className="text-center mb-12 lg:mb-16 flex flex-col"
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          transition={{ duration: 0.6 }}
        >
          <h3 className="text-lg font-semibold mb-4 order-1 text-gold-700">
            <span className="relative flex h-2 w-2 mr-2 inline-flex">
              <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-500 opacity-75" />
              <span className="relative inline-flex rounded-full h-2 w-2 bg-emerald-500" />
            </span>
            S≈Çowa kt√≥re napƒôdzajƒÖ nas do dzia≈Çania
          </h3>

          <h2 className="text-3xl sm:text-4xl lg:text-5xl font-bold mb-6 leading-tight order-2 text-foreground">
            Opinie klient√≥w{' '}
            <span className="text-gold-700">taxi zastƒôpczego</span>
            <br className="hidden md:inline" />
            <span className="text-2xl sm:text-3xl lg:text-4xl block mt-2 text-muted-foreground">
              z OC sprawcy
            </span>
          </h2>
        </motion.div>

        {/* Statystyki */}
        <motion.div 
          className="grid grid-cols-2 lg:grid-cols-4 gap-6 lg:gap-8 mb-16"
          variants={containerVariants}
          initial="hidden"
          whileInView="visible"
          viewport={{ once: true }}
        >
          {STATS.map((stat, index) => (
            <motion.div
              key={index}
              variants={statVariants}
              className="text-center group"
            >
              <div className="bg-white rounded-2xl p-6 border border-gray-100 hover:border-gray-200 transition-all duration-300 shadow-sm hover:shadow-md group-hover:-translate-y-1">
                <div className="text-3xl mb-2">{stat.icon}</div>
                <div className="text-2xl lg:text-3xl font-bold mb-1 text-gold-700">
                  {stat.number}
                </div>
                <div className="text-sm font-medium text-muted-foreground">
                  {stat.label}
                </div>
              </div>
            </motion.div>
          ))}
        </motion.div>

        {/* G≈Ç√≥wny testimonial */}
        <motion.div 
          className="max-w-4xl mx-auto mb-12"
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          transition={{ duration: 0.6 }}
        >
          <div 
            className="bg-white rounded-3xl p-8 lg:p-12 border border-gray-100 shadow-lg relative overflow-hidden"
            onMouseEnter={() => setIsAutoPlaying(false)}
            onMouseLeave={() => setIsAutoPlaying(true)}
          >
            {/* Decorative quote */}
            <div className="absolute top-6 right-6 text-6xl opacity-10 font-serif text-gold-700">
              &ldquo;
            </div>

            {/* Content */}
            <motion.div
              key={currentTestimonial}
              initial={{ opacity: 0, x: 20 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ duration: 0.5 }}
            >
              {/* Stars */}
              <div className="mb-6">
                {renderStars(TESTIMONIALS[currentTestimonial].rating)}
              </div>

              {/* Text */}
              <blockquote className="text-lg lg:text-xl leading-relaxed mb-6 font-medium text-foreground">
                &ldquo;{TESTIMONIALS[currentTestimonial].text}&rdquo;
              </blockquote>

              {/* Author info */}
              <div className="flex items-center justify-between">
                <div>
                  <div className="font-bold text-lg text-foreground">
                    {TESTIMONIALS[currentTestimonial].name}
                  </div>
                  <div className="text-sm text-muted-foreground">
                    {TESTIMONIALS[currentTestimonial].service} ‚Ä¢ {TESTIMONIALS[currentTestimonial].location}
                  </div>
                </div>

                {/* Service badge */}
                <div className="px-3 py-1 rounded-full text-xs font-semibold bg-gold-700/10 text-gold-700">
                  Zweryfikowana opinia
                </div>
              </div>
            </motion.div>
          </div>

          {/* Navigation dots */}
          <div className="flex justify-center mt-8 gap-3">
            {TESTIMONIALS.map((_, index) => (
              <button
                key={index}
                onClick={() => {
                  setCurrentTestimonial(index);
                  setIsAutoPlaying(false);
                  setTimeout(() => setIsAutoPlaying(true), 3000);
                }}
                className={`w-3 h-3 rounded-full transition-all duration-300 hover:scale-125 ${
                  index === currentTestimonial ? 'bg-gold-700' : 'bg-border'
                }`}
                aria-label={`Przejd≈∫ do opinii ${index + 1}`}
              />
            ))}
          </div>
        </motion.div>

        {/* Pozosta≈Çe opinie w siatce - ukryte na mobile, widoczne od tablet w g√≥rƒô */}
        <motion.div 
          className="hidden md:grid md:grid-cols-2 lg:grid-cols-3 gap-6 mt-12"
          variants={containerVariants}
          initial="hidden"
          whileInView="visible"
          viewport={{ once: true }}
        >
          {TESTIMONIALS.slice(1).map((testimonial, index) => {
            const originalIndex = index + 1; // +1 bo slice zaczyna od 1
            const isActive = originalIndex === currentTestimonial;
            
            return (
              <motion.div
                key={`testimonial-${originalIndex}`}
                variants={cardVariants}
                whileHover={{ y: -5 }}
                className={`group cursor-pointer transition-all duration-300 ${
                  index >= 3 ? 'hidden lg:block' : ''
                } ${
                  index >= 5 ? 'hidden xl:block' : ''
                }`}
                onClick={() => {
                  setCurrentTestimonial(originalIndex);
                  setIsAutoPlaying(false);
                  setTimeout(() => setIsAutoPlaying(true), 3000);
                }}
              >
                <div 
                  className={`bg-white rounded-2xl p-6 transition-all duration-300 h-full shadow-sm hover:shadow-md ${
                    isActive 
                      ? 'border-2 shadow-md border-gold-700 shadow-gold-700/20' 
                      : 'border border-gray-100 hover:border-gray-200'
                  }`}
                >
                  {/* Active indicator */}
                  {isActive && (
                    <div className="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold mb-3 bg-gold-700/10 text-gold-700">
                      Aktualnie wy≈õwietlana
                    </div>
                  )}

                  {/* Stars */}
                  <div className="mb-4">
                    {renderStars(testimonial.rating)}
                  </div>

                  {/* Text */}
                  <p className="text-sm leading-relaxed mb-4 text-muted-foreground">
                    &ldquo;{testimonial.text.length > 120 ? testimonial.text.substring(0, 120) + '...' : testimonial.text}&rdquo;
                  </p>

                  {/* Author */}
                  <div className="flex items-center justify-between">
                    <div>
                      <div className="font-semibold text-sm text-foreground">
                        {testimonial.name}
                      </div>
                      <div className="text-xs text-muted-foreground">
                        {testimonial.location}
                      </div>
                    </div>
                    <svg 
                      className={`w-4 h-4 group-hover:translate-x-1 transition-transform ${
                        isActive ? 'text-gold-700' : 'text-muted-foreground'
                      }`}
                      fill="none" 
                      stroke="currentColor" 
                      viewBox="0 0 24 24"
                    >
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                    </svg>
                  </div>
                </div>
              </motion.div>
            );
          })}
        </motion.div>

        {/* Informacja o wiƒôcej opiniach na tablet+ */}
        <motion.div 
          className="text-center mt-8 hidden md:block lg:hidden"
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          transition={{ duration: 0.6, delay: 0.2 }}
        >
          <p className="text-sm font-medium text-muted-foreground">
            Zobacz wiƒôcej opinii na wiƒôkszych ekranach lub prze≈ÇƒÖczajƒÖc g≈Ç√≥wnƒÖ opiniƒô
          </p>
        </motion.div>
      </div>
    </section>
  );
}

export default memo(TestimonialsSection);